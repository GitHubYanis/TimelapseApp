<div class="min-h-screen bg-gray-100 p-8">
  <div class="max-w-md mx-auto bg-white rounded-xl shadow-md p-6">
    <h2 class="text-2xl font-bold text-gray-800 mb-6">@if (running) { Ongoing Timelapse... } @else { New Timelapse }</h2>

    <div class="space-y-4">
      @if (!running) {
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2"> Capture frequency </label>
          <app-dropdown
            [options]="frequencyOptions"
            [selectedValue]="settings.frequency.value"
            (selectionChange)="onSettingChange('frequency', $event)"
          />
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2"> Total Duration </label>
          <app-dropdown
            [options]="durationOptions"
            [selectedValue]="settings.duration.value"
            (selectionChange)="onSettingChange('duration', $event)"
          />
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2"> Image resolution </label>
          <app-dropdown
            [options]="resolutionOptions"
            [selectedValue]="settings.resolution.value"
            (selectionChange)="onSettingChange('resolution', $event)"
          />
        </div>

        @if (isFrequencyTooHigh) {
          <div class="p-3 bg-red-100 border border-red-400 text-red-700 rounded">
            Error: Capture frequency must be lower than total duration
          </div>
        }

        @if (expectedFrames !== null && !isFrequencyTooHigh) {
          <div class="p-3 bg-blue-100 border border-blue-400 text-blue-700 rounded">
            <strong>Expected frames:</strong> {{ expectedFrames }}
          </div>
        }

        <div class="flex justify-center">
          <button (click)="start()" class="px-4 py-2 bg-green-500 text-white rounded">Start</button>
        </div>
      }

      @if (running) {
        <div class="p-3 bg-gray-50 border border-gray-200 rounded">
          <p><strong>Capture Frequency:</strong> {{ settings.frequency.label }}</p>
          <p><strong>Total Duration:</strong> {{ settings.duration.label }} </p>
          <p><strong>Resolution:</strong> {{ settings.resolution.label }}</p>
        </div>

        <div class="p-3 bg-blue-50 border border-blue-300 rounded">
            <div class="flex justify-between items-center">
              <strong>Frame {{ frameNumber }} out of {{ expectedFrames }}:</strong>
              <button (click)="getLatestFrameInfo()" class="px-4 py-2 bg-blue-500 text-white rounded">Refresh</button>
          </div>
          @if (timestamp) {
            <img [src]="'http://localhost:8000/timelapse/latest-frame?t=' + timestamp" width="100%" class="mt-2 rounded" />
          }
          <div class="pt-3 flex justify-center text-blue-800">
            <p><strong>Expected end date:</strong> {{ endDate?.toLocaleString() }}</p>
          </div>
        </div>

        @if (error) {
          <div class="p-3 bg-red-100 border border-red-400 text-red-700 rounded">
            {{ error }}
          </div>
        }

        <div class="flex justify-center">
          <button (click)="stop()" class="px-4 py-2 bg-red-500 text-white rounded">Stop</button>
        </div>
      }
      @if (error && !running) {
        <div class="p-3 bg-red-100 border border-red-400 text-red-700 rounded">
          {{ error }}
        </div>
      }
    </div>
  </div>
</div>
